<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lanou.mapper.ContractcMapper">
	<cache />
	<resultMap id="BaseResultMap" type="com.lanou.entity.Contractc">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Jan 05 
			15:47:01 CST 2018. -->
		<id column="CONTRACT_ID" jdbcType="VARCHAR" property="CONTRACT_ID" />
		<result column="OFFEROR" jdbcType="VARCHAR" property="OFFEROR" />
		<result column="CONTRACT_NO" jdbcType="VARCHAR" property="CONTRACT_NO" />
		<result column="SIGNING_DATE" jdbcType="TIMESTAMP" property="SIGNING_DATE" />
		<result column="INPUT_BY" jdbcType="VARCHAR" property="INPUT_BY" />
		<result column="CHECK_BY" jdbcType="VARCHAR" property="CHECK_BY" />
		<result column="INSPECTOR" jdbcType="VARCHAR" property="INSPECTOR" />
		<result column="TOTAL_AMOUNT" jdbcType="DECIMAL" property="TOTAL_AMOUNT" />
		<result column="IMPORT_NUM" jdbcType="DECIMAL" property="IMPORT_NUM" />
		<result column="CREQUEST" jdbcType="VARCHAR" property="CREQUEST" />
		<result column="CUSTOM_NAME" jdbcType="VARCHAR" property="CUSTOM_NAME" />
		<result column="DELIVERY_PERIOD" jdbcType="TIMESTAMP" property="DELIVERY_PERIOD" />
		<result column="SHIP_TIME" jdbcType="TIMESTAMP" property="SHIP_TIME" />
		<result column="TRADE_TERMS" jdbcType="VARCHAR" property="TRADE_TERMS" />
		<result column="REMARK" jdbcType="VARCHAR" property="REMARK" />
		<result column="PRINT_STYLE" jdbcType="CHAR" property="PRINT_STYLE" />
		<result column="OLD_STATE" jdbcType="DECIMAL" property="OLD_STATE" />
		<result column="STATE" jdbcType="DECIMAL" property="STATE" />
		<result column="OUT_STATE" jdbcType="DECIMAL" property="OUT_STATE" />
		<result column="CREATE_BY" jdbcType="VARCHAR" property="CREATE_BY" />
		<result column="CREATE_DEPT" jdbcType="VARCHAR" property="CREATE_DEPT" />
		<result column="CREATE_TIME" jdbcType="TIMESTAMP" property="CREATE_TIME" />
	</resultMap>



	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Jan 05 
			15:47:01 CST 2018. -->
		CONTRACT_ID, OFFEROR, CONTRACT_NO, SIGNING_DATE, INPUT_BY, CHECK_BY,
		INSPECTOR, TOTAL_AMOUNT,
		IMPORT_NUM, CREQUEST, CUSTOM_NAME,
		DELIVERY_PERIOD, SHIP_TIME, TRADE_TERMS,
		REMARK,
		PRINT_STYLE, OLD_STATE,
		STATE, OUT_STATE, CREATE_BY, CREATE_DEPT, CREATE_TIME
	</sql>

	<!-- 厂家销售记录 -->
	<select id="selectFactoryLog" resultType="com.lanou.bean.FactoryRecordBean">
		SELECT f.factory_name, cp.countnum
		FROM (SELECT factory_id, factory_name FROM factory_c) f
		RIGHT JOIN (SELECT factory_id, COUNT(*) AS countnum
		FROM contract_product_c
		GROUP BY factory_id) cp
		ON f.factory_id = cp.factory_id

	</select>


	<!-- 查询一页显示的内容 -->
	<select id="selectPageContract" resultType="com.lanou.bean.ContractBean">
		SELECT
		t.CONTRACT_ID,t.SIGNING_DATE,t.CONTRACT_NO
		,t.CUSTOM_NAME,t.DELIVERY_PERIOD,t.SHIP_TIME,t.TOTAL_AMOUNT,t.STATE,t4.CNUMBER,t8.expNum
		from CONTRACT_C t
		left JOIN (
		SELECT sum(t3.CNUMBER) as
		CNUMBER,t2.CONTRACT_ID from CONTRACT_C t2
		inner JOIN CONTRACT_PRODUCT_C
		t3 on t3.CONTRACT_ID = t2.CONTRACT_ID
		group by t2.CONTRACT_ID
		) t4 on
		t4.CONTRACT_ID = t.CONTRACT_ID
		left JOIN (
		SELECT sum(t7.CNUMBER) as
		expNum,t5.CONTRACT_ID from CONTRACT_C t5
		inner JOIN CONTRACT_PRODUCT_C
		t6 on t6.CONTRACT_ID = t5.CONTRACT_ID
		inner join EXT_CPRODUCT_C t7 on
		t6.CONTRACT_PRODUCT_ID =
		t7.CONTRACT_PRODUCT_ID
		group by t5.CONTRACT_ID
		) t8 on t8.CONTRACT_ID= t.CONTRACT_ID ORDER BY t.SIGNING_DATE DESC


	</select>

	<!-- 新增货物的修改状态为上报 -->
	<update id="updateState" parameterType="java.lang.String">
		update CONTRACT_C set
		state = 1 where CONTRACT_ID = #{id}

	</update>

	<delete id="delete" parameterType="java.lang.String">

		delete from CONTRACT_C
		where CONTRACT_ID = #{id,jdbcType=VARCHAR}



	</delete>



	<!-- 出货表月统计导出 -->
	<select id="selectOutproduct" resultType="com.lanou.bean.OutProductBean">

		select
		p.contract_product_id,c.custom_name,c.contract_no,
		to_char(c.delivery_period, 'YYYY-MM-DD') as delivery_period,
		to_char(c.ship_time, 'YYYY-MM-DD') as ship_time,
		c.trade_terms,p.factory_name
		,p.product_no,p.cnumber from
		(select
		t.contract_id,t.custom_name,t.contract_no,t.delivery_period,t.ship_time,t.trade_terms
		from CONTRACT_C t) c
		left join contract_product_c p
		on p.contract_id =
		c.contract_id
		where 1=1

		<if test="shipTime!=null and shipTime!= ''">
			and to_char(c.ship_time,'YYYY-MM') like
			concat(concat('%',#{shipTime}),'%')
		</if>

	</select>



	<!-- 根据id查询内容 -->
	<select id="selectByPrimaryKey" parameterType="java.lang.String"
		resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from CONTRACT_C
		where CONTRACT_ID = #{CONTRACT_ID,jdbcType=VARCHAR}
	</select>
	<!-- 根据id删除合同 -->
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		delete from
		CONTRACT_C
		where CONTRACT_ID = #{CONTRACT_ID,jdbcType=VARCHAR}
	</delete>

	<insert id="insert" parameterType="com.lanou.entity.Contractc">
		insert into CONTRACT_C
		(CONTRACT_ID, OFFEROR, CONTRACT_NO,
		SIGNING_DATE, INPUT_BY, CHECK_BY,
		INSPECTOR, TOTAL_AMOUNT, IMPORT_NUM,
		CREQUEST, CUSTOM_NAME,
		DELIVERY_PERIOD,
		SHIP_TIME, TRADE_TERMS, REMARK,
		PRINT_STYLE, OLD_STATE,
		STATE,
		OUT_STATE, CREATE_BY, CREATE_DEPT,
		CREATE_TIME)
		values
		(#{CONTRACT_ID,jdbcType=VARCHAR}, #{OFFEROR,jdbcType=VARCHAR},
		#{CONTRACT_NO,jdbcType=VARCHAR},
		#{SIGNING_DATE,jdbcType=TIMESTAMP},
		#{INPUT_BY,jdbcType=VARCHAR}, #{CHECK_BY,jdbcType=VARCHAR},
		#{INSPECTOR,jdbcType=VARCHAR}, #{TOTAL_AMOUNT,jdbcType=DECIMAL},
		#{IMPORT_NUM,jdbcType=DECIMAL},
		#{CREQUEST,jdbcType=VARCHAR},
		#{CUSTOM_NAME,jdbcType=VARCHAR},
		#{DELIVERY_PERIOD,jdbcType=TIMESTAMP},
		#{SHIP_TIME,jdbcType=TIMESTAMP}, #{TRADE_TERMS,jdbcType=VARCHAR},
		#{REMARK,jdbcType=VARCHAR},
		#{PRINT_STYLE,jdbcType=CHAR},
		#{OLD_STATE,jdbcType=DECIMAL}, #{STATE,jdbcType=DECIMAL},
		#{OUT_STATE,jdbcType=DECIMAL}, #{CREATE_BY,jdbcType=VARCHAR},
		#{CREATE_DEPT,jdbcType=VARCHAR},
		#{CREATE_TIME,jdbcType=TIMESTAMP})
	</insert>
	<!-- 动态添加 -->
	<insert id="insertSelective" parameterType="com.lanou.entity.Contractc">
		<selectKey keyProperty="CONTRACT_ID" resultType="java.lang.String"
			order="BEFORE">
			select sys_guid() from dual
		</selectKey>
		insert into CONTRACT_C
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="CONTRACT_ID != null">
				CONTRACT_ID,
			</if>
			<if test="OFFEROR != null">
				OFFEROR,
			</if>
			<if test="CONTRACT_NO != null">
				CONTRACT_NO,
			</if>
			<if test="SIGNING_DATE != null">
				SIGNING_DATE,
			</if>
			<if test="INPUT_BY != null">
				INPUT_BY,
			</if>
			<if test="CHECK_BY != null">
				CHECK_BY,
			</if>
			<if test="INSPECTOR != null">
				INSPECTOR,
			</if>
			<if test="TOTAL_AMOUNT != null">
				TOTAL_AMOUNT,
			</if>
			<if test="IMPORT_NUM != null">
				IMPORT_NUM,
			</if>
			<if test="CREQUEST != null">
				CREQUEST,
			</if>
			<if test="CUSTOM_NAME != null">
				CUSTOM_NAME,
			</if>
			<if test="DELIVERY_PERIOD != null">
				DELIVERY_PERIOD,
			</if>
			<if test="SHIP_TIME != null">
				SHIP_TIME,
			</if>
			<if test="TRADE_TERMS != null">
				TRADE_TERMS,
			</if>
			<if test="REMARK != null">
				REMARK,
			</if>
			<if test="PRINT_STYLE != null">
				PRINT_STYLE,
			</if>
			<if test="OLD_STATE != null">
				OLD_STATE,
			</if>
			<if test="STATE != null">
				STATE,
			</if>
			<if test="OUT_STATE != null">
				OUT_STATE,
			</if>
			<if test="CREATE_BY != null">
				CREATE_BY,
			</if>
			<if test="CREATE_DEPT != null">
				CREATE_DEPT,
			</if>
			<if test="CREATE_TIME != null">
				CREATE_TIME,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="CONTRACT_ID != null">
				#{CONTRACT_ID,jdbcType=VARCHAR},
			</if>
			<if test="OFFEROR != null">
				#{OFFEROR,jdbcType=VARCHAR},
			</if>
			<if test="CONTRACT_NO != null">
				#{CONTRACT_NO,jdbcType=VARCHAR},
			</if>
			<if test="SIGNING_DATE != null">
				#{SIGNING_DATE,jdbcType=TIMESTAMP},
			</if>
			<if test="INPUT_BY != null">
				#{INPUT_BY,jdbcType=VARCHAR},
			</if>
			<if test="CHECK_BY != null">
				#{CHECK_BY,jdbcType=VARCHAR},
			</if>
			<if test="INSPECTOR != null">
				#{INSPECTOR,jdbcType=VARCHAR},
			</if>
			<if test="TOTAL_AMOUNT != null">
				#{TOTAL_AMOUNT,jdbcType=DECIMAL},
			</if>
			<if test="IMPORT_NUM != null">
				#{IMPORT_NUM,jdbcType=DECIMAL},
			</if>
			<if test="CREQUEST != null">
				#{CREQUEST,jdbcType=VARCHAR},
			</if>
			<if test="CUSTOM_NAME != null">
				#{CUSTOM_NAME,jdbcType=VARCHAR},
			</if>
			<if test="DELIVERY_PERIOD != null">
				#{DELIVERY_PERIOD,jdbcType=TIMESTAMP},
			</if>
			<if test="SHIP_TIME != null">
				#{SHIP_TIME,jdbcType=TIMESTAMP},
			</if>
			<if test="TRADE_TERMS != null">
				#{TRADE_TERMS,jdbcType=VARCHAR},
			</if>
			<if test="REMARK != null">
				#{REMARK,jdbcType=VARCHAR},
			</if>
			<if test="PRINT_STYLE != null">
				#{PRINT_STYLE,jdbcType=CHAR},
			</if>
			<if test="OLD_STATE != null">
				#{OLD_STATE,jdbcType=DECIMAL},
			</if>
			<if test="STATE != null">
				#{STATE,jdbcType=DECIMAL},
			</if>
			<if test="OUT_STATE != null">
				#{OUT_STATE,jdbcType=DECIMAL},
			</if>
			<if test="CREATE_BY != null">
				#{CREATE_BY,jdbcType=VARCHAR},
			</if>
			<if test="CREATE_DEPT != null">
				#{CREATE_DEPT,jdbcType=VARCHAR},
			</if>
			<if test="CREATE_TIME != null">
				#{CREATE_TIME,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.lanou.entity.Contractc">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Jan 05 
			15:47:01 CST 2018. -->
		update CONTRACT_C
		<set>
			<if test="OFFEROR != null">
				OFFEROR = #{OFFEROR,jdbcType=VARCHAR},
			</if>
			<if test="CONTRACT_NO != null">
				CONTRACT_NO = #{CONTRACT_NO,jdbcType=VARCHAR},
			</if>
			<if test="SIGNING_DATE != null">
				SIGNING_DATE = #{SIGNING_DATE,jdbcType=TIMESTAMP},
			</if>
			<if test="INPUT_BY != null">
				INPUT_BY = #{INPUT_BY,jdbcType=VARCHAR},
			</if>
			<if test="CHECK_BY != null">
				CHECK_BY = #{CHECK_BY,jdbcType=VARCHAR},
			</if>
			<if test="INSPECTOR != null">
				INSPECTOR = #{INSPECTOR,jdbcType=VARCHAR},
			</if>
			<if test="TOTAL_AMOUNT != null">
				TOTAL_AMOUNT = #{TOTAL_AMOUNT,jdbcType=DECIMAL},
			</if>
			<if test="IMPORT_NUM != null">
				IMPORT_NUM = #{IMPORT_NUM,jdbcType=DECIMAL},
			</if>
			<if test="CREQUEST != null">
				CREQUEST = #{CREQUEST,jdbcType=VARCHAR},
			</if>
			<if test="CUSTOM_NAME != null">
				CUSTOM_NAME = #{CUSTOM_NAME,jdbcType=VARCHAR},
			</if>
			<if test="DELIVERY_PERIOD != null">
				DELIVERY_PERIOD = #{DELIVERY_PERIOD,jdbcType=TIMESTAMP},
			</if>
			<if test="SHIP_TIME != null">
				SHIP_TIME = #{SHIP_TIME,jdbcType=TIMESTAMP},
			</if>
			<if test="TRADE_TERMS != null">
				TRADE_TERMS = #{TRADE_TERMS,jdbcType=VARCHAR},
			</if>
			<if test="REMARK != null">
				REMARK = #{REMARK,jdbcType=VARCHAR},
			</if>
			<if test="PRINT_STYLE != null">
				PRINT_STYLE = #{PRINT_STYLE,jdbcType=CHAR},
			</if>
			<if test="OLD_STATE != null">
				OLD_STATE = #{OLD_STATE,jdbcType=DECIMAL},
			</if>
			<if test="STATE != null">
				STATE = #{STATE,jdbcType=DECIMAL},
			</if>
			<if test="OUT_STATE != null">
				OUT_STATE = #{OUT_STATE,jdbcType=DECIMAL},
			</if>
			<if test="CREATE_BY != null">
				CREATE_BY = #{CREATE_BY,jdbcType=VARCHAR},
			</if>
			<if test="CREATE_DEPT != null">
				CREATE_DEPT = #{CREATE_DEPT,jdbcType=VARCHAR},
			</if>
			<if test="CREATE_TIME != null">
				CREATE_TIME = #{CREATE_TIME,jdbcType=TIMESTAMP},
			</if>
		</set>
		where CONTRACT_ID = #{CONTRACT_ID,jdbcType=VARCHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.lanou.entity.Contractc">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Fri Jan 05 
			15:47:01 CST 2018. -->
		update CONTRACT_C
		set OFFEROR = #{OFFEROR,jdbcType=VARCHAR},
		CONTRACT_NO = #{CONTRACT_NO,jdbcType=VARCHAR},
		SIGNING_DATE =
		#{SIGNING_DATE,jdbcType=TIMESTAMP},
		INPUT_BY =
		#{INPUT_BY,jdbcType=VARCHAR},
		CHECK_BY = #{CHECK_BY,jdbcType=VARCHAR},
		INSPECTOR = #{INSPECTOR,jdbcType=VARCHAR},
		TOTAL_AMOUNT =
		#{TOTAL_AMOUNT,jdbcType=DECIMAL},
		IMPORT_NUM =
		#{IMPORT_NUM,jdbcType=DECIMAL},
		CREQUEST =
		#{CREQUEST,jdbcType=VARCHAR},
		CUSTOM_NAME =
		#{CUSTOM_NAME,jdbcType=VARCHAR},
		DELIVERY_PERIOD =
		#{DELIVERY_PERIOD,jdbcType=TIMESTAMP},
		SHIP_TIME =
		#{SHIP_TIME,jdbcType=TIMESTAMP},
		TRADE_TERMS =
		#{TRADE_TERMS,jdbcType=VARCHAR},
		REMARK = #{REMARK,jdbcType=VARCHAR},
		PRINT_STYLE = #{PRINT_STYLE,jdbcType=CHAR},
		OLD_STATE =
		#{OLD_STATE,jdbcType=DECIMAL},
		STATE = #{STATE,jdbcType=DECIMAL},
		OUT_STATE = #{OUT_STATE,jdbcType=DECIMAL},
		CREATE_BY =
		#{CREATE_BY,jdbcType=VARCHAR},
		CREATE_DEPT =
		#{CREATE_DEPT,jdbcType=VARCHAR},
		CREATE_TIME =
		#{CREATE_TIME,jdbcType=TIMESTAMP}
		where CONTRACT_ID =
		#{CONTRACT_ID,jdbcType=VARCHAR}
	</update>
</mapper>